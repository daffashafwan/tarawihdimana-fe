<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>tarawihdimana</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <style>
        .navbar-custom {
            background-color: #2C666E;
        }

        .btn-custom-1 {
            background-color: #2C666E;
            color: #F0EDEE;
            border-radius: 2rem;
        }

        .btn-custom-1:hover {
            background-color: #07393C;
            color: #F0EDEE;
        }

        .title-custom {
            font-family: 'Helvetica', sans-serif;
        }
    </style>
</head>

<body class="text-center">

    <section class="vh-100" style="background-color: #F0EDEE;">
        <nav class="navbar navbar-custom navbar-expand-lg navbar-light shadow">
            <div class="container">
                <a class="navbar-brand text-white" href="#">tarawihdimana</a>
                <button class="navbar-toggler text-white" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link text-white" href="https://github.com/daffashafwan/tarawihdimana-fe" target="_blank">repo</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <div class="container py-5">
            <div class="row d-flex justify-content-center align-items-center">
                <div class="col-12">
                    <div class="row">
                        <h1 class="title-custom">Tarawih dimana hari ini ?</h1>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card shadow p-3 mb-5 bg-body border-0" style="border-radius: 2rem;">
                                <div class="card-body p-5 text-center">
                                    <div class="row">
                                        <button onclick="getDeviceLocation()" class="btn btn-custom-1 btn-lg shadow"
                                            type="submit">Cari
                                            Masjid</button>
                                    </div>
                                </div>
                                <div id="result">

                                </div>
                                <div id="map"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
<script>
    var map;
    function getDeviceLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                var latitude = position.coords.latitude;
                var longitude = position.coords.longitude;

                if (isNaN(latitude) || isNaN(longitude)) {
                    alert("Please enter valid latitude and longitude values.");
                    return;
                }

                console.log(latitude, longitude)
                $.ajax({
                    url: "https://dffshfwn.online/tarawihdimana/random-nearest-mosque",
                    type: 'POST',
                    contentType: 'application/json', // Set content type to JSON
                    dataType: 'json',
                    data: JSON.stringify({
                        latitude: latitude,
                        longitude: longitude,
                        radius: 1000,
                        limit: 20
                    }),
                    success: function (data) {
                        // Handle the response data here
                        console.log(data);
                        // Display single card
                        $('#result').empty();
                        var resultsContainer = document.getElementById("result");
                        var card = document.createElement("div");
                        card.className = "card shadow p-3 mb-5 border-0 rounded-3";
                        card.innerHTML = `
                            <div class="card-body ">
                                <h5 class="card-title">${data.title}</h5>
                                <p class="card-text">${data.address.label}</p>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">${data.address.subdistrict}</li>
                                    <li class="list-group-item">${data.address.district}</li>
                                    <li class="list-group-item">${data.address.city}</li>
                                </ul>
                            </div>
                        `;
                        resultsContainer.appendChild(card);
                        var mapContainer = document.getElementById("map");
                        mapContainer.style.height = "35vh";
                        initMap(latitude, longitude, data)
                    },
                    error: function (error) {
                        // Handle the error here
                        console.error("Error:", error);
                    }
                });
            }, function (error) {
                alert("Error getting device location: " + error.message);
            });
        } else {
            alert("Geolocation is not supported by this browser.");
        }

        function initMap(lat, lng, resp) {
            if (typeof map !== 'undefined') {
                // If the map exists, remove it
                map.remove();
            }
            
            map = L.map('map').setView([lat, lng], 15);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);

            L.Routing.control({
                waypoints: [
                    L.latLng(lat, lng),
                    L.latLng(resp.position.lat, resp.position.lng)
                ],
                //routeWhileDragging: true,
            }).addTo(map);

            $(".leaflet-routing-container.leaflet-bar.leaflet-routing-collapsible.leaflet-control").addClass("leaflet-routing-container-hide");
        }
    }
</script>

</html>